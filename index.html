<!DOCTYPE html>
<html>
  <head>
    <title>Unifix Cubes</title>
    <meta charset="UTF-8" />
    <meta http-equiv="Cache-control" content="public" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />

    <meta
      name="viewport"
      id="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <link rel="stylesheet" type="text/css" href="css/croquispop.css" />

    <link rel="stylesheet" type="text/css" href="css/main.css" />
   <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
   <script type="text/javascript" src="js/loader.js"></script>
    <script type="text/javascript" src="js/libs/jquery-1.10.2-min.js"></script>
    <script type="text/javascript" src="js/libs/jquery-ui.min.js"></script>
    <script
      type="text/javascript"
      src="js/libs/jquery-ui-touch-punch-0.2.2.js"
    ></script>

    <script type="text/javascript" src="js/libs/hittest.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <style>
      /* floating cursor image */
      #cursor-ghost {
        position: fixed;
        width: 32px;
        height: 32px;
        pointer-events: none;
        z-index: 999999;
        display: none;
        image-rendering: auto;
      }
      /* hide the native cursor only over the drawing/stage area */
      .hide-native-cursor #canvas-area,
      .hide-native-cursor #canvas-area canvas,
      .hide-native-cursor .drop-box-container,
      .hide-native-cursor .drop-box-container canvas {
        cursor: none !important;
      }
    </style>

  </head>
  <!-- cube action menu -->

  <body>
    <!-- <div id="canvas-area"></div> -->
       <div class="canvas-container">
        <canvas id="draw" width="800" height="600"></canvas>
        
        <div class="toolbar">
            <div class="tool pencil" data-tool-tip="Pencil Tool" id="pencilTool"></div>
            <div class="tool eraser" data-tool-tip="Eraser Tool" id="eraserTool"></div>
        </div>
        
        <!-- Pencil Control Panel -->
        <div class="control-panel hide" id="pencilPanel">
            <div class="panel-header">
                <div class="panel-title">Pencil Settings</div>
                <div class="close-btn" id="closePencilPanel">✕</div>
            </div>
            <label for="pencilBrushSize">Brush Size</label>
            <input type="range" class="brushSize" id="pencilBrushSize" value="5" min="1" max="50">
            <div class="brush-size-preview" id="pencilBrushSizePreview"></div>
            
            <label for="pencilBrushOpacity">Opacity</label>
            <input type="range" class="brushOpacity" id="pencilBrushOpacity" value="1" min="0.1" max="1" step="0.1">
            
            <div class="color-selector">
                <label for="pencilColorPicker">Color</label>
                <input type="color" id="pencilColorPicker" value="#e53935">
                <div class="color-preview" id="pencilColorPreview"></div>
            </div>
        </div>
        
        <!-- Eraser Control Panel -->
        <div class="control-panel hide" id="eraserPanel">
            <div class="panel-header">
                <div class="panel-title">Eraser Settings</div>
                <div class="close-btn" id="closeEraserPanel">✕</div>
            </div>
            <label for="eraserBrushSize">Brush Size</label>
            <input type="range" class="brushSize" id="eraserBrushSize" value="10" min="1" max="50">
            <div class="brush-size-preview" id="eraserBrushSizePreview"></div>
        </div>
    </div>
   

    <div acc-id="main-container" class="main-container-block">
      <div acc-id="act-container">
        <div class="tool-container tool-container-theme ui-droppable" >
          <div class="tool-grp">
            <div class="cube-container-block">
              <div
                id="cube1"
                tempid="cube1"
                class="cubes clickable ui-draggable"
                rotateval="0"
              >
                <div class="spearateCubes">
                  <img
                    style="width: 55%; height: 50%"
                    src="assets/images/arrow.png"
                  />
                </div>
                <div id="uppercont" class="uppercont connector"></div>
                <div id="downcont" class="downcont connector"></div>
                <img
                  style="width: 100%; height: 100%"
                  src="assets/images/cube1.png"
                />
              </div>

              <div
                id="cube2"
                tempid="cube2"
                class="cubes clickable ui-draggable"
              >
                <div class="spearateCubes">
                  <img
                    style="width: 55%; height: 50%"
                    src="assets/images/arrow.png"
                  />
                </div>
                <div id="uppercont" class="uppercont connector"></div>
                <div id="downcont" class="downcont connector"></div>
                <img
                  style="width: 100%; height: 100%"
                  src="assets/images/cube2.png"
                />
              </div>

              <div
                id="cube3"
                tempid="cube3"
                class="cubes clickable ui-draggable"
              >
                <div class="spearateCubes">
                  <img
                    style="width: 55%; height: 50%"
                    src="assets/images/arrow.png"
                  />
                </div>
                <div id="uppercont" class="uppercont connector"></div>
                <div id="downcont" class="downcont connector"></div>
                <img
                  style="width: 100%; height: 100%"
                  src="assets/images/cube3.png"
                />
              </div>

              <div
                id="cube4"
                tempid="cube4"
                class="cubes clickable ui-draggable"
              >
                <div class="spearateCubes">
                  <img
                    style="width: 55%; height: 50%"
                    src="assets/images/arrow.png"
                  />
                </div>
                <div id="uppercont" class="uppercont connector"></div>
                <div id="downcont" class="downcont connector"></div>
                <img
                  style="width: 100%; height: 100%"
                  src="assets/images/cube4.png"
                />
              </div>

              <div
                id="cube5"
                tempid="cube5"
                class="cubes clickable ui-draggable"
              >
                <div class="spearateCubes">
                  <img
                    style="width: 55%; height: 50%"
                    src="assets/images/arrow.png"
                  />
                </div>
                <div id="uppercont" class="uppercont connector"></div>
                <div id="downcont" class="downcont connector"></div>
                <img
                  style="width: 100%; height: 100%"
                  src="assets/images/cube5.png"
                />
              </div>

              <div
                id="cube6"
                tempid="cube6"
                class="cubes clickable ui-draggable"
              >
                <div class="spearateCubes">
                  <img
                    style="width: 55%; height: 50%"
                    src="assets/images/arrow.png"
                  />
                </div>
                <div id="uppercont" class="uppercont connector"></div>
                <div id="downcont" class="downcont connector"></div>
                <img
                  style="width: 100%; height: 100%"
                  src="assets/images/cube6.png"
                />
              </div>

              <div
                id="cube7"
                tempid="cube7"
                class="cubes clickable ui-draggable"
              >
                <div class="spearateCubes">
                  <img
                    style="width: 55%; height: 50%"
                    src="assets/images/arrow.png"
                  />
                </div>
                <div id="uppercont" class="uppercont connector"></div>
                <div id="downcont" class="downcont connector"></div>
                <img
                  style="width: 100%; height: 100%"
                  src="assets/images/cube7.png"
                />
              </div>

              <div
                id="cube8"
                tempid="cube8"
                class="cubes clickable ui-draggable"
              >
                <div class="spearateCubes">
                  <img
                    style="width: 55%; height: 50%"
                    src="assets/images/arrow.png"
                  />
                </div>
                <div id="uppercont" class="uppercont connector"></div>
                <div id="downcont" class="downcont connector"></div>
                <img
                  style="width: 100%; height: 100%"
                  src="assets/images/cube8.png"
                />
              </div>

              <div
                id="cube9"
                tempid="cube9"
                class="cubes clickable ui-draggable"
              >
                <div class="spearateCubes">
                  <img
                    style="width: 55%; height: 50%"
                    src="assets/images/arrow.png"
                  />
                </div>
                <div id="uppercont" class="uppercont connector"></div>
                <div id="downcont" class="downcont connector"></div>
                <img
                  style="width: 100%; height: 100%"
                  src="assets/images/cube9.png"
                />
              </div>

              <div
                id="cube10"
                tempid="cube10"
                class="cubes clickable ui-draggable"
              >
                <div class="spearateCubes">
                  <img
                    style="width: 55%; height: 50%"
                    src="assets/images/arrow.png"
                  />
                </div>
                <div id="uppercont" class="uppercont connector"></div>
                <div id="downcont" class="downcont connector"></div>
                <img
                  style="width: 100%; height: 100%"
                  src="assets/images/cube10.png"
                />
              </div>

              <div
                id="cube11"
                tempid="cube11"
                class="cubes clickable ui-draggable"
              >
                <div class="spearateCubes">
                  <img
                    style="width: 55%; height: 50%"
                    src="assets/images/arrow.png"
                  />
                </div>
                <div id="uppercont" class="uppercont connector"></div>
                <div id="downcont" class="downcont connector"></div>
                <img
                  style="width: 100%; height: 100%"
                  src="assets/images/cube11.png"
                />
              </div>
              <div
                id="cube12"
                tempid="cube12"
                class="cubes clickable ui-draggable"
              >
                <div class="spearateCubes">
                  <img
                    style="width: 55%; height: 50%"
                    src="assets/images/arrow.png"
                  />
                </div>
                <div id="uppercont" class="uppercont connector"></div>
                <div id="downcont" class="downcont connector"></div>
                <img
                  style="width: 100%; height: 100%"
                  src="assets/images/cube12.png"
                />
              </div>
            </div>
            <div class="secondmenubar">
              <div class="menubar-conatiner">
                <div class="pencile-block">
                  <label>Drawing</label>
                  <div id="pencil" class="clickable" style="opacity: 0.6">
                    <img
                      style="width: 100%; height: 100%"
                      src="assets/images/pencil.png"
                    />
                  </div>
                </div>
                <div class="eraser-Block">
                  <label>Eraser</label>
                  <div id="eraser" class="clickable" style="opacity: 0.6">
                    <img
                      style="width: 100%; height: 100%"
                      src="assets/images/eraser.png"
                    />
                  </div>
                </div>
                <div class="undoresress-block">
                  <label>Clear</label>
                  <div id="undo" class="clickable disabled">
                    <img
                      style="width: 88%; height: 88%; margin-top: 2px"
                      src="assets/images/rotate.png"
                    />
                  </div>
                </div>
              </div>

              <div class="menubar-conatiner" style="gap: 10px">
                <div id="undore" class="clickable disabled" title="Undo">
                  <img
                    style="width: 35px; height: 35px"
                    src="assets/images/undo.png"
                  />
                </div>
                <div id="redore" class="clickable disabled" title="Redo">
                  <img
                    style="width: 35px; height: 35px"
                    src="assets/images/redo.png"
                  />
                </div>
              </div>

              <div class="menubar-conatiner themechanger-mobile" style="gap: 10px">
                <div id="groupCount" class="clickable">
                  <img
                    style="width: 40px; height: 40px"
                    src="assets/images/groupcount.png"
                  />
                </div>
                <div id="screenshot" class="screenshot-btn">
                  <img
                    style="width: 40px; height: 40px"
                    src="assets/images/screenshot.png"
                  />
                </div>
                <div class="cubecnager">
                   
                    <select id="cubeTypeSelector">
                      <option value="kids" selected>Kids Cube</option>
                      <option value="raw">Raw Cube</option>
                      <option value="2d">2D Cube</option>
                    </select>
                </div>
                 
              </div>
            </div>
            <div class="themechnager-menubar">
                 <h3><img style="width: 18px;margin: -4px;margin-left: 0px;" src="assets/images/cubeicon/paint.png" />&nbsp; Select Theme</h3>
                <select id="themeSelect" class="themeSelect">
                  <optgroup label="🖼️ Image Themes">
                    <option value="hill">Hill</option>
                    <option value="candy">Candy</option>
                    <option value="sky">Sky</option>
                    <option value="playground">Playground</option>
                    <option value="water">Water</option>
                  </optgroup>
                  <optgroup label="🎬 Video Themes">
                    <option value="car">Car Play</option>
                    <option value="space">Space</option>
                  </optgroup>
                  <optgroup label="🎨 Default Themes">
                    <option value="white">White</option>
                    <option value="black">Black</option>
                  </optgroup>
                </select>
            </div>
          </div>
        </div>

        <div class="drop-container">
          <div class="drop-box-container ui-droppable"></div>
        </div>
      </div>
    </div>

    <div id="cubeMenu" class="cube-menu" style="position: absolute">
      <div
        id="cubeMenuMessage"
        class="cube-menu-message"
        style="display: none"
      ></div>
      <div class="cube-menu-section">Cube Actions</div>
      <button data-action="lock"><img src="assets/images/cubeicon/padlock.png" /> Lock Cube</button>
      <button data-action="unlock" style="display: none"><img src="assets/images/cubeicon/tools.png" /> Unlock Cube</button>
      <hr />
      <button data-action="duplicate"><img src="assets/images/cubeicon/duplicate.png" /> Duplicate Cube</button>
      <button data-action="rotate"><img src="assets/images/cubeicon/loop-arrow.png" /> Rotate Cube</button>
      <button data-action="changeColor"><img src="assets/images/cubeicon/change-management.png" /> Change Cube</button>
      <hr />
      <button data-action="download"><img src="assets/images/cubeicon/download.png" /> Download as PNG</button>
      <button data-action="copy"><img src="assets/images/cubeicon/copy.png" /> Copy Cube</button>
      <button data-action="paste" style="display: none"><img src="assets/images/cubeicon/paste.png" /> Paste Cube</button>
      <hr />
      <button data-action="delete"><img src="assets/images/cubeicon/laundry-basket.png" /> Delete Cube</button>
      <button data-action="deleteGroup" style="display: none">
        <img src="assets/images/cubeicon/delete.png" /> Delete Group
      </button>
      <button data-action="properties"><img src="assets/images/cubeicon/properties.png" /> Cube Properties</button>
    </div>
    <div id="colorPicker" class="color-picker-popup" style="display: none">
      <div style="margin-bottom: 8px">Select a color:</div>
      <div id="colorOptions">
        <!-- Color options will be generated here -->
      </div>
    </div>

    <!-- Cube Properties Modal -->
    <div id="cubePropertiesModal" class="cube-properties-modal">
      <div class="cube-properties-content">
        <div class="cube-properties-header">
          <div class="cube-properties-title">Cube Properties</div>
          <button class="close-properties">&times;</button>
        </div>

        <div class="properties-list">
          <!-- <div class="property-item">
            <span class="property-label">Temporary ID:</span>
            <span id="propTempId" class="property-value">-</span>
          </div> -->
          <div class="property-item">
            <span class="property-label">Status:</span>
            <span id="propLockStatus" class="property-value">-</span>
          </div>
          <div class="property-item">
            <span class="property-label">Rotation:</span>
            <span id="propRotation" class="property-value">-</span>
          </div>
          <div class="property-item">
            <span class="property-label">Cubes in Group:</span>
            <span id="propCubesInGroup" class="property-value">-</span>
          </div>
          <div class="property-item">
            <span class="property-label">Cube Position:</span>
            <span id="propCubePosition" class="property-value">-</span>
          </div>
          <!-- <div class="property-item">
            <span class="property-label">Color:</span>
            <span id="propColor" class="property-value">-</span>
          </div> -->
          <div class="property-item">
            <span class="property-label">Connectors:</span>
            <span id="propConnectors" class="property-value">-</span>
          </div>
        </div>
      </div>
    </div>
    <video id="videoBackground" autoplay muted loop style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: fill; z-index: -2; display: none;"></video>
  </body>

  <script type="text/javascript" src="js/act.js"></script>
  <!-- <script type="text/javascript" src="js/sreenshoot.js"></script> -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script src="js/croquis/croquis.js"></script>
  <script src="js/croquispop.js"></script>
  <script src="js/theme.js"></script>
   <script src="js/cube.js"></script>

  <script>
    (function () {
      // Create the floating cursor element once
      const ghost = document.createElement("img");
      ghost.id = "cursor-ghost";
      document.body.appendChild(ghost);

      // Try to find your stage element(s)
      const stage =
        document.querySelector(".drop-box-container") ||
        document.querySelector("#canvas-area") ||
        document.body;

      let activeTool = null; // 'pen' | 'eraser' | null

      function setToolCursor(tool) {
        activeTool = tool; // remember
        if (tool) {
          // pick your own images if you want
          ghost.src =
            tool === "pen"
              ? "assets/images/pencil.png"
              : "assets/images/eraser.png";

          // position tweak so the tip feels right
          ghost.style.transform =
            tool === "pen"
              ? "translate(-4px, -28px)" // pen tip
              : "translate(-16px, -16px)"; // eraser center

          ghost.style.display = "block";
          document.body.classList.add("hide-native-cursor");
        } else {
          ghost.style.display = "none";
          document.body.classList.remove("hide-native-cursor");
        }
      }

      // Follow the pointer
      function moveGhost(e) {
        if (!activeTool) return;
        ghost.style.left = e.clientX + "px";
        ghost.style.top = e.clientY + "px";
      }
      document.addEventListener("pointermove", moveGhost);

      // Hide when leaving stage, show when entering (if tool active)
      function inStage(e) {
        const r = stage.getBoundingClientRect();
        return (
          e.clientX >= r.left &&
          e.clientX <= r.right &&
          e.clientY >= r.top &&
          e.clientY <= r.bottom
        );
      }
      document.addEventListener("pointermove", (e) => {
        if (!activeTool) return;
        ghost.style.display = inStage(e) ? "block" : "none";
      });

      // Wire your buttons
      document.getElementById("pencil")?.addEventListener("click", function () {
        setToolCursor("pen");
        // your draw-mode activation can stay as-is (Croquis, etc.)
      });
      document.getElementById("eraser")?.addEventListener("click", function () {
        setToolCursor("eraser");
        // your eraser activation can stay as-is
      });

      // When switching back to move/select (e.g., starting to drag cubes), disable the custom cursor
      document.querySelectorAll(".cubes, #undo").forEach((el) => {
        el.addEventListener("mousedown", () => setToolCursor(null));
      });

      // Optional: default state on load
      setToolCursor(null);
    })();
  </script>

  <script>

const containersd = document.body; // or the parent of tempItem

const observer = new MutationObserver(() => {
  const blackBlock = document.querySelector('.main-container-block-black');

  document.querySelectorAll('.tempItem img').forEach(img => {
    if (blackBlock) {
      // Invert if tempItem comes BEFORE blackBlock
      if (img.closest('.tempItem').compareDocumentPosition(blackBlock) & Node.DOCUMENT_POSITION_FOLLOWING) {
        img.style.filter = 'invert(1)';
      }
    } else {
      // Remove invert when blackBlock is gone
      img.style.filter = '';
    }
  });
});

// Start observing DOM changes
observer.observe(containersd, { childList: true, subtree: true });

  </script>
  <script>
  function moveThemeChanger() {
    const themeChanger = document.querySelector('.themechnager-menubar');
    const secondMenuBar = document.querySelector('.secondmenubar');
    const mobileContainer = document.querySelector('.themechanger-mobile');

    if (!themeChanger || !secondMenuBar || !mobileContainer) return;

    if (window.innerWidth < 768) {
      // ✅ Move inside .themechanger-mobile
      if (themeChanger.parentElement !== mobileContainer) {
        mobileContainer.appendChild(themeChanger);
      }
    } else {
      // ✅ Move outside .secondmenubar
      if (secondMenuBar.nextElementSibling !== themeChanger) {
        secondMenuBar.insertAdjacentElement('afterend', themeChanger);
      }
    }
  }

  // Run on page load
  moveThemeChanger();

  // Run on window resize
  window.addEventListener('resize', moveThemeChanger);
</script>
<script>
  function moveCubeChanger() {
    const cubeChanger = document.querySelector('.cubecnager');
    const secondMenuBar = document.querySelector('.secondmenubar');
    const themeChangerMobile = document.querySelector('.themechanger-mobile');

    if (!cubeChanger || !secondMenuBar || !themeChangerMobile) return;

    if (window.innerWidth < 768) {
      // ✅ Move outside (under .secondmenubar)
      if (secondMenuBar.nextElementSibling !== cubeChanger) {
        secondMenuBar.insertAdjacentElement('afterend', cubeChanger);
      }
    } else {
      // ✅ Move back inside .themechanger-mobile
      if (cubeChanger.parentElement !== themeChangerMobile) {
        themeChangerMobile.appendChild(cubeChanger);
      }
    }
  }

  // Run on page load
  moveCubeChanger();

  // Run on window resize
  window.addEventListener('resize', moveCubeChanger);
</script>
    <script>
        // Canvas setup
        const canvas = document.getElementById('draw');
        const ctx = canvas.getContext('2d');
        
        // Tool elements
        const pencilTool = document.getElementById('pencilTool');
        const eraserTool = document.getElementById('eraserTool');
        
        // Panel elements
        const pencilPanel = document.getElementById('pencilPanel');
        const eraserPanel = document.getElementById('eraserPanel');
        const closePencilPanel = document.getElementById('closePencilPanel');
        const closeEraserPanel = document.getElementById('closeEraserPanel');
        
        // Pencil controls
        const pencilBrushSize = document.getElementById('pencilBrushSize');
        const pencilBrushOpacity = document.getElementById('pencilBrushOpacity');
        const pencilBrushSizePreview = document.getElementById('pencilBrushSizePreview');
        const pencilColorPicker = document.getElementById('pencilColorPicker');
        const pencilColorPreview = document.getElementById('pencilColorPreview');
        
        // Eraser controls
        const eraserBrushSize = document.getElementById('eraserBrushSize');
        const eraserBrushSizePreview = document.getElementById('eraserBrushSizePreview');
        
        // Drawing state
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let pencilActive = false;
        let eraserActive = false;
        
        // Tool settings
        let pencilSettings = {
            size: parseInt(pencilBrushSize.value),
            opacity: parseFloat(pencilBrushOpacity.value),
            color: pencilColorPicker.value
        };
        
        let eraserSettings = {
            size: parseInt(eraserBrushSize.value)
        };
        
        // Initialize canvas
        function initCanvas() {
            canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            
            // Set initial brush previews
            updatePencilBrushPreview();
            updateEraserBrushPreview();
            updateColorPreview();
        }
        
        // Update pencil brush preview
        function updatePencilBrushPreview() {
            pencilBrushSizePreview.style.width = `${pencilSettings.size}px`;
            pencilBrushSizePreview.style.height = `${pencilSettings.size}px`;
            pencilBrushSizePreview.style.backgroundColor = pencilSettings.color;
            pencilBrushSizePreview.style.opacity = pencilSettings.opacity;
        }
        
        // Update eraser brush preview
        function updateEraserBrushPreview() {
            eraserBrushSizePreview.style.width = `${eraserSettings.size}px`;
            eraserBrushSizePreview.style.height = `${eraserSettings.size}px`;
            eraserBrushSizePreview.style.backgroundColor = '#ffffff';
        }
        
        // Update color preview
        function updateColorPreview() {
            pencilColorPreview.style.backgroundColor = pencilSettings.color;
        }
        
        // Position panel above tool
        function positionPanel(panel, tool) {
            const toolRect = tool.getBoundingClientRect();
            const panelRect = panel.getBoundingClientRect();
            
            panel.style.top = `${toolRect.top - panelRect.height - 10}px`;
            panel.style.left = `${toolRect.left}px`;
        }
        
        // Toggle pencil tool
        function togglePencil() {
            if (pencilActive) {
                // Deactivate pencil
                pencilActive = false;
                pencilTool.classList.remove('active');
                canvas.style.cursor = 'default';
                pencilPanel.classList.add('hide');
            } else {
                // Activate pencil
                pencilActive = true;
                pencilTool.classList.add('active');
                canvas.style.cursor = 'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="black" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>\') 0 24, auto';
                
                // Deactivate eraser if active
                if (eraserActive) {
                    eraserActive = false;
                    eraserTool.classList.remove('active');
                    eraserPanel.classList.add('hide');
                }
                
                // Show pencil panel
                positionPanel(pencilPanel, pencilTool);
                pencilPanel.classList.remove('hide');
            }
        }
        
        // Toggle eraser tool
        function toggleEraser() {
            if (eraserActive) {
                // Deactivate eraser
                eraserActive = false;
                eraserTool.classList.remove('active');
                canvas.style.cursor = 'default';
                eraserPanel.classList.add('hide');
            } else {
                // Activate eraser
                eraserActive = true;
                eraserTool.classList.add('active');
                canvas.style.cursor = 'url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="black" d="M16.24 3.56l4.95 4.94c.78.79.78 2.05 0 2.84L12 20.53a4.008 4.008 0 0 1-5.66 0L2.81 17c-.78-.79-.78-2.05 0-2.84l10.83-10.88c.79-.78 2.05-.78 2.83 0L16.24 3.56zM4.22 15.58l3.54 3.53c.39.39 1.02.39 1.41 0l3.53-3.53-4.95-4.95-3.53 3.95z"/></svg>\') 12 12, auto';
                
                // Deactivate pencil if active
                if (pencilActive) {
                    pencilActive = false;
                    pencilTool.classList.remove('active');
                    pencilPanel.classList.add('hide');
                }
                
                // Show eraser panel
                positionPanel(eraserPanel, eraserTool);
                eraserPanel.classList.remove('hide');
            }
        }
        
        // Start drawing
        function startDrawing(e) {
            if (!pencilActive && !eraserActive) return;
            
            isDrawing = true;
            [lastX, lastY] = getCoordinates(e);
            
            // For pencil, start a new path
            if (pencilActive) {
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineWidth = pencilSettings.size;
                ctx.globalAlpha = pencilSettings.opacity;
                ctx.strokeStyle = pencilSettings.color;
                ctx.globalCompositeOperation = 'source-over';
            } else if (eraserActive) {
                ctx.lineWidth = eraserSettings.size;
                ctx.globalCompositeOperation = 'destination-out';
            }
        }
        
        // Draw
        function draw(e) {
            if (!isDrawing || (!pencilActive && !eraserActive)) return;
            
            const [x, y] = getCoordinates(e);
            
            if (pencilActive) {
                ctx.lineTo(x, y);
                ctx.stroke();
            } else if (eraserActive) {
                ctx.beginPath();
                ctx.arc(x, y, eraserSettings.size / 2, 0, Math.PI * 2);
                ctx.fill();
            }
            
            [lastX, lastY] = [x, y];
        }
        
        // Stop drawing
        function stopDrawing() {
            isDrawing = false;
            
            if (pencilActive) {
                ctx.closePath();
            }
        }
        
        // Get coordinates from event (mouse or touch)
        function getCoordinates(e) {
            let clientX, clientY;
            
            if (e.type.includes('touch')) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }
            
            const rect = canvas.getBoundingClientRect();
            const x = clientX - rect.left;
            const y = clientY - rect.top;
            
            return [x, y];
        }
        
        // Event listeners for tools
        pencilTool.addEventListener('click', togglePencil);
        eraserTool.addEventListener('click', toggleEraser);
        
        // Close panel buttons
        closePencilPanel.addEventListener('click', () => {
            pencilPanel.classList.add('hide');
            pencilActive = false;
            pencilTool.classList.remove('active');
            canvas.style.cursor = 'default';
        });
        
        closeEraserPanel.addEventListener('click', () => {
            eraserPanel.classList.add('hide');
            eraserActive = false;
            eraserTool.classList.remove('active');
            canvas.style.cursor = 'default';
        });
        
        // Update pencil settings
        pencilBrushSize.addEventListener('input', (e) => {
            pencilSettings.size = parseInt(e.target.value);
            updatePencilBrushPreview();
        });
        
        pencilBrushOpacity.addEventListener('input', (e) => {
            pencilSettings.opacity = parseFloat(e.target.value);
            updatePencilBrushPreview();
        });
        
        pencilColorPicker.addEventListener('input', (e) => {
            pencilSettings.color = e.target.value;
            updatePencilBrushPreview();
            updateColorPreview();
        });
        
        // Update eraser settings
        eraserBrushSize.addEventListener('input', (e) => {
            eraserSettings.size = parseInt(e.target.value);
            updateEraserBrushPreview();
        });
        
        // Mouse events
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);
        
        // Touch events for mobile support
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            startDrawing(e);
        });
        
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            draw(e);
        });
        
        canvas.addEventListener('touchend', (e) => {
            e.preventDefault();
            stopDrawing();
        });
        
        // Initialize the canvas
        initCanvas();
    </script>
</html>
